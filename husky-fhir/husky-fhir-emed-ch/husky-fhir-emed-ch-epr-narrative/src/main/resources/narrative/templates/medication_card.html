<!--/*
  ~ This code is made available under the terms of the Eclipse Public License v1.0
  ~ in the github project https://github.com/project-husky/husky there you also
  ~ find a list of the contributors and the license information.
  ~
  ~ This project has been developed further and modified by the joined working group Husky
  ~ on the basis of the eHealth Connector opensource project from June 28, 2021,
  ~ whereas medshare GmbH is the initial and main contributor/author of the eHealth Connector.
  */-->
<th:block th:switch="${lang.name()}">
    <h1>Carte de médication</h1>

    <table class="table-header">
        <tr>
            <td class="cell-patient">
                <h2>Patient</h2>
                <th:block
                        th:include="~{patient :: display-name-address-contact(${resource.resolvePatient()}, ${lang})}"/>
            </td>
            <td class="cell-author">
                <h2>Auteur du document</h2>
                ${resource.resolveComposition().resolveAuthor()}
            </td>
        </tr>
    </table>

    <h2>Traitements actifs</h2>
    <table>
        <thead>
        <tr>
            <td rowspan="2">Nom du médicament</td>
            <td colspan="4">Dosage</td>
            <td rowspan="2">Voie et localisation</td>
        </tr>
        <tr>
            <td>Matin</td>
            <td>Midi</td>
            <td>Soir</td>
            <td>Nuit</td>
        </tr>
        </thead>
        <tbody>
        <tr th:each="medStmt: ${activeTreatments}"
            th:with="dosage = ${medStmt.resolveEffectiveDosageInstructions()}">
            <td th:text="${medStmt.resolveMedication().resolveMedicationName()}"/>
            <th:block th:if="${dosage.hasIntakes()}">
                <td th:insert="~{datatypes :: dosage-intake(${dosage.getMornIntake()}, ${lang})}"/>
                <td th:insert="~{datatypes :: dosage-intake(${dosage.getNoonIntake()}, ${lang})}"/>
                <td th:insert="~{datatypes :: dosage-intake(${dosage.getEveIntake()}, ${lang})}"/>
                <td th:insert="~{datatypes :: dosage-intake(${dosage.getNightIntake()}, ${lang})}"/>
            </th:block>
            <th:block th:if="${not dosage.hasIntakes()}">
                <td colspan="4" th:text="${dosage.patientInstructions()}"/>
            </th:block>
            <td>
                <th:block th:if="${dosage.hasRouteOfAdministration()}"
                          th:text="${fopase.getMessage(dosage.routeOfAdministration(), lang)}"/>
            </td>
        </tr>

        <tr th:if="${activeTreatments.empty}">
            <td colspan="6">Aucun traitement actif</td>
        </tr>
        </tbody>
    </table>


    <h2>Traitements en réserve</h2>
    <table>
        <thead>
        <tr>
            <td rowspan="2">Nom du médicament</td>
            <td colspan="4">Dosage</td>
            <td rowspan="2">Voie et localisation</td>
        </tr>
        <tr>
            <td>Matin</td>
            <td>Midi</td>
            <td>Soir</td>
            <td>Nuit</td>
        </tr>
        </thead>
        <tbody>
        <tr th:each="medStmt: ${asneededTreatments}"
            th:with="dosage = ${medStmt.resolveEffectiveDosageInstructions()}">
            <td th:text="${medStmt.resolveMedication().resolveMedicationName()}"/>
            <th:block th:if="${dosage.hasIntakes()}">
                <td th:insert="~{datatypes :: dosage-intake(${dosage.getMornIntake()}, ${lang})}"/>
                <td th:insert="~{datatypes :: dosage-intake(${dosage.getNoonIntake()}, ${lang})}"/>
                <td th:insert="~{datatypes :: dosage-intake(${dosage.getEveIntake()}, ${lang})}"/>
                <td th:insert="~{datatypes :: dosage-intake(${dosage.getNightIntake()}, ${lang})}"/>
            </th:block>
            <th:block th:if="${not dosage.hasIntakes()}">
                <td colspan="4" th:text="${dosage.patientInstructions()}"/>
            </th:block>
            <td>
                <th:block th:if="${dosage.hasRouteOfAdministration()}"
                          th:text="${fopase.getMessage(dosage.routeOfAdministration(), lang)}"/>
            </td>
        </tr>

        <tr th:if="${asneededTreatments.empty}">
            <td colspan="6">Aucun traitement en réserve</td>
        </tr>
        </tbody>
    </table>
</th:block>
